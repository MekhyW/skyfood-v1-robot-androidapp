import{C as e,r as a,W as t,p as s,e as i,c as o,a as n,L as l,a3 as d,T as c,M as u,u as r,I as p,ag as m,K as v,R as g,n as h,o as k,P as y,O as b,b3 as f,b2 as x,aZ as T,S as I}from"./@vue-73fba911.js";import{y as w,aV as D,Q as j,g as S,W as C,R as $,t as _,aK as z,_ as L,aL as V,$ as q,aA as A,aB as P,aC as E,T as U,aG as R,aH as O,aW as B}from"./index-d6250428.js";import{h as M,i as N}from"./element-plus-5a8aeb67.js";import{_ as W,C as H}from"./cruiseSetting-8659e41a.js";import{B as K}from"./index-f7b9e1fb.js";import"./vue-router-fe18c2fe.js";import"./vue-i18n-5829ac11.js";import"./@intlify-352b7567.js";import"./pinia-118dd6fd.js";import"./@element-plus-c72353dc.js";import"./vue3-loading-overlay-a6191c09.js";import"./vue-slider-component-7621b196.js";import"./@autoxing-9bbbdd2d.js";import"./axios-2c1be958.js";import"./websocket-963e06e0.js";import"./es5-ext-689fde2c.js";import"./vue-6ec50eb9.js";import"./mitt-dab1f1cb.js";import"./swiper-276df855.js";import"./ssr-window-792d0f84.js";import"./dom7-250848e3.js";import"./amfe-flexible-1f7bb7f4.js";import"./dayjs-4c03de08.js";import"./lodash-es-fa68f30b.js";import"./@vueuse-171ed302.js";import"./@ctrl-ee9bdfd4.js";import"./async-validator-efc2d198.js";import"./@popperjs-892fd7f5.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-da779ce4.js";const G={class:"add-task"},J={class:"task-item"},Q=["onClick"],Z=[(e=>(f("data-v-c06064f5"),e=e(),x(),e))((()=>n("img",{src:W,alt:""},null,-1)))],F={key:1,class:"err-text"},X={key:2,class:"err-text"},Y={key:3,class:"err-text"},ee={class:"btn-list"},ae={class:"right-btn"},te={key:0,class:"update_password"},se={class:"_makcontent2"},ie={class:"update_password_header font6"},oe={key:0,class:"password_cont"},ne={class:"font-20"},le={key:1,class:"password_cont"},de={class:"font-20"},ce={class:"tip_meth"},ue=L(e({__name:"AddTask",props:{data:{type:Object,default:null}},emits:["cancel","sure"],setup(e,{emit:f}){const x=e,T=w(),I=a(null),L=t({poiList:D.value.filter((e=>9!==e.type)),activeTypeList:[{name:j.global.t("index.ddjh"),id:40},{name:j.global.t("index.jq"),id:47},{name:j.global.t("index.xj"),id:48}],audioList:[],pauseTimeList:[{name:j.global.t("index.btl"),id:0},{name:j.global.t("index.dd"),id:-1},{name:"5s",id:5},{name:"10s",id:10},{name:"15s",id:15},{name:"20s",id:20},{name:"25s",id:25},{name:"30s",id:30},{name:"35s",id:35},{name:"40s",id:40},{name:"45s",id:45},{name:"50s",id:50},{name:"55s",id:55},{name:"1min",id:60},{name:"2min",id:120},{name:"3min",id:180},{name:"4min",id:240},{name:"5min",id:300},{name:"10min",id:600},{name:"20min",id:1200},{name:"30min",id:1800}],curError:-1,curErrorActiveType:-1,taskData:[],invalidPoiList:[],poiTypeNotMatching:[]});let V=t({selectList:[],show:!1,type:"",curItem:-1}),q=t({show:!1,name:"",businessId:S.businessId,areaId:"",id:""});s((()=>(e,a)=>(console.log(e,a),z(e,a)))),i((()=>{P(),A()}));const A=()=>{const e={data:{type:4},reqType:"onResList",uniqueId:(new Date).getTime()};C.getInstance().onopen(e).then((e=>{const a=JSON.parse(e);L.audioList=a.data.list.map((e=>(e.id=e.path,e)))}))},P=()=>{[4].includes(T.robotType)&&(L.activeTypeList=[{name:j.global.t("index.ddjh"),id:40}]),L.invalidPoiList=[],x.data&&(q.name=x.data.name,q.id=x.data.id,x.data.taskData.length&&(E(),L.taskData=x.data.taskData)),L.taskData.length||L.taskData.push({poiData:null,poiId:"",activeType:"",audioId:"",pauseTime:""})},E=async()=>{const e=x.data.taskData;for(let a=0;a<e.length;a++){L.poiList.find(((t,s)=>t.id===e[a].poiId))||L.invalidPoiList.push(e[a].poiId)}},U=()=>{L.curError=L.taskData.findIndex((e=>!e.poiId||!e.activeType&&![4].includes(T.robotType)||""===e.pauseTime)),-1===L.curError&&(L.taskData.push({poiData:null,poiId:"",activeType:"",audioId:"",pauseTime:""}),h((()=>{I.value.scrollTop=I.value.scrollHeight})))},R=(e,a,t="")=>{t&&(e.poiData=L.poiList.find((a=>e.poiId===a.id))),L.curError===a&&e.poiId&&e.activeType&&""!==e.pauseTime&&(L.curError=-1)};function O(){if(q.name){const e=L.taskData.map((e=>e.poiData.areaId)),a={taskData:L.taskData,name:q.name,id:q.id,businessId:q.businessId,areaId:[...new Set(e)].join(",")};console.log(a,"saveCustomizeTask"),$.getInstance().saveCustomizeTask(a).then((e=>{e&&200===e.status&&(q.show=!1,q.id?_.show(j.global.t("cruise.gxcg")):_.show(j.global.t("cruise.xzcg")),q.id="",f("sure"))}))}}const B=e=>{console.log(e),"poiId"===V.type?(L.taskData[V.curItem].poiData=e,L.taskData[V.curItem].poiId=e.id):"activeType"===V.type?L.taskData[V.curItem].activeType=e.id:"audioId"===V.type?L.taskData[V.curItem].audioId=e.id:"pauseTime"===V.type&&(L.taskData[V.curItem].pauseTime=e.id);const a=L.taskData[V.curItem];L.curError===V.curItem&&a.poiId&&a.activeType&&""!==a.pauseTime&&(L.curError=-1),V.type="",V.curItem=-1,V.show=!1},W=()=>{f("cancel")},H=()=>{let e=!1;L.curError=L.taskData.findIndex((a=>([47,48].includes(a.activeType)&&a.poiData&&34!==a.poiData.type&&(e=!0),!a.poiId||!a.activeType&&![4].includes(T.robotType)||""===a.pauseTime||L.invalidPoiList.includes(a.poiId)))),L.taskData.length<2?_.show(j.global.t("cruise.dwgs")):-1!==L.curError||e||(q.show=!0)};return(e,a)=>{const t=M,s=N;return k(),o("div",G,[n("div",{class:"task-list",ref_key:"taskList",ref:I},[(k(!0),o(l,null,d(L.taskData,((a,i)=>(k(),o("div",J,[g(s,{class:"select-box",modelValue:a.poiId,"onUpdate:modelValue":e=>a.poiId=e,placeholder:e.$t("index.qxzrwd"),size:"large",teleported:!1,onChange:e=>R(a,i,"poiId"),clearable:""},{default:y((()=>[(k(!0),o(l,null,d(L.poiList,(e=>(k(),b(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"]),g(s,{class:"select-box",modelValue:a.activeType,"onUpdate:modelValue":e=>a.activeType=e,placeholder:e.$t("index.qxzdzlx"),size:"large",teleported:!1,onChange:e=>R(a,i),clearable:""},{default:y((()=>[(k(!0),o(l,null,d(L.activeTypeList,(e=>(k(),b(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"]),g(s,{class:"select-box",modelValue:a.audioId,"onUpdate:modelValue":e=>a.audioId=e,placeholder:e.$t("index.qxzbbyp"),size:"large",teleported:!1,onChange:e=>R(a,i),clearable:""},{default:y((()=>[(k(!0),o(l,null,d(L.audioList,(e=>(k(),b(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"]),g(s,{class:"select-box",modelValue:a.pauseTime,"onUpdate:modelValue":e=>a.pauseTime=e,placeholder:e.$t("index.qxztlsj"),size:"large",teleported:!1,onChange:e=>R(a,i),clearable:""},{default:y((()=>[(k(!0),o(l,null,d(L.pauseTimeList,(e=>(k(),b(t,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"]),0!==i?(k(),o("span",{key:0,class:"del",onClick:e=>(e=>{L.curError=-1,L.taskData.splice(e,1)})(i)},Z,8,Q)):v("",!0),L.invalidPoiList.includes(a.poiId)?(k(),o("span",F,c(e.$t("cruise.wxdw")),1)):i===L.curError?(k(),o("span",X,c(e.$t("index.qwsdqsjx")),1)):[47,48].includes(a.activeType)&&a.poiData&&34!==a.poiData.type?(k(),o("span",Y,c(e.$t("index.rwdlxqxzhjd")),1)):v("",!0)])))),256))],512),n("div",ee,[n("div",{class:"add-task-btn btn",onClick:U}," + "+c(e.$t("setting.tj")),1),n("div",ae,[n("div",{class:"cancel btn",onClick:W},c(e.$t("index.qx")),1),n("div",{class:u(["active btn",-1!==L.curError?"disable":""]),onClick:H},c(e.$t("index.qd")),3)])]),r(q).show?(k(),o("div",te,[n("div",se,[n("div",ie,c(e.$t("starup.ts")),1),r(q).id?(k(),o("div",oe,[n("span",ne,c(e.$t("cruise.qrtj")+r(q).name+e.$t("cruise.xg")),1)])):(k(),o("div",le,[n("span",de,c(e.$t("index.qsrxzrwmc")),1),p(n("input",{class:"input-name","onUpdate:modelValue":a[0]||(a[0]=e=>r(q).name=e)},null,512),[[m,r(q).name]])])),n("div",ce,[n("div",{class:"btn",onClick:a[1]||(a[1]=e=>r(q).show=!1)},c(e.$t("index.qx")),1),n("div",{class:u(["btn",{disabled:!r(q).name}]),onClick:O},c(e.$t("cruise.bc")),3)])])])):v("",!0),g(K,{ref:"BSelectComponent",selectList:r(V).selectList,onCancel:a[2]||(a[2]=e=>r(V).show=!1),controlType:r(V).show,onSure:B},null,8,["selectList","controlType"])])}}}),[["__scopeId","data-v-c06064f5"]]),re={class:"customize"},pe={class:"custom-btn"},me={class:"custom-task"},ve=["src"],ge={class:"task-list"},he={class:"task-item task-title"},ke={class:"name"},ye={class:"points"},be={class:"active"},fe={class:"operate-box"},xe={class:"task-box"},Te=["onClick"],Ie={class:"name"},we={class:"points"},De={class:"active"},je={class:"operate-box"},Se=["onClick"],Ce=["onClick"],$e={class:"start-box"},_e={key:0,class:"update_password"},ze={class:"_makcontent2"},Le={class:"update_password_header font6"},Ve={class:"password_cont"},qe={style:{"font-size":"20px"}},Ae={class:"tip_meth"},Pe=L(e({__name:"Customize",setup(e){const i=w(),p=a(!1),m=a(!1),h=t({curSelect:"",curTask:null,list:[]}),y=s((()=>e=>{let a=0;return e&&e.length&&e.forEach((e=>{console.log(e),e.audioId?a+=3:a+=2})),a}));function f(){h.curTask=null,h.curSelect="",$.getInstance().getCustomizeTaskList().then((e=>{e&&200===e.status&&(h.list=e.data.list)}))}function x(e){return new Promise((async(a,t)=>{let s=[];for(let i=0;i<e.length;i++){const a=await $.getInstance().getPoiById(e[i].poiId);a&&(e[i].poiData=a,s.push(e[i]))}a(s)}))}function D(){V.show({downTimes:10}).then((e=>{e&&(h.curTask=null,p.value=!0)}))}function S(){p.value=!1}function C(){S(),f()}function z(){$.getInstance().delCustomizeTask(h.curTask.id).then((e=>{e&&200===e.status&&(m.value=!1,f())}))}function L(e){let a=null,t=R[2];t&&t[e+""]&&(a=t[e+""]);let s={mode:P,audioId:q.audioIdset("3111002"),num:1,volume:i.customSetting.sound.switchon?i.customSetting.sound.voiceVolume:0,interval:-1,duration:-1,forcePlay:!0};return a&&(s.url=O(a.fileUrl),a.fileUrl&&(s.audioId=""),s.interval=a.ruleInterval,1==a.ruleType?s.num=a.ruleCount:2==a.ruleType&&(s.duration=a.ruleDuration)),s}async function M(){const e=q.offlineSetting.cruiseSetting||{};let a=0;0==e.customize.type?a=99999:1==e.customize.type&&(a=e.customize.num);const t=h.list[h.curSelect];if(t){const e=await x(t.taskData);if(console.log(e),t.taskData.length!==e.length)return void _.show(j.global.t("index.zdysx"));let s=[],o=-1;for(let a=0;a<e.length;a++){let t=e[a];if(console.log(t),!t.poiData.coordinate)continue;const n={x:t.poiData.coordinate[0],y:t.poiData.coordinate[1],yaw:t.poiData.yaw,areaId:t.poiData.areaId,type:t.poiData.type,dockingRadius:t.poiData.properties&&t.poiData.properties.dockingRadius?t.poiData.properties.dockingRadius:"1",ext:{name:t.poiData.name,id:t.poiData.id},stepActs:[]};[47,48].includes(t.activeType)?(t.audioId?n.stepActs.push({type:A.PlayAudio,data:{mode:P,audioId:t.audioId,num:1,volume:i.customSetting.sound.switchon?i.customSetting.sound.voiceVolume:0,interval:-1,duration:-1,channel:1}}):n.stepActs.push({type:A.PlayAudio,data:{mode:P,audioId:q.audioIdset(47===t.activeType?"3112044":"3112046"),num:1,volume:i.customSetting.sound.switchon?i.customSetting.sound.voiceVolume:0,interval:-1,duration:-1,channel:1}}),n.stepActs.push({type:t.activeType,data:{index:o}}),t.pauseTime&&n.stepActs.push({type:A.InterAction,data:{pauseTime:t.pauseTime}})):(n.ext.isLoadPoi=!0,t.audioId?n.stepActs.push({type:A.PlayAudio,data:{mode:P,audioId:t.audioId,num:1,volume:i.customSetting.sound.switchon?i.customSetting.sound.voiceVolume:0,interval:-1,duration:-1,channel:1}}):n.stepActs.push({type:A.PlayAudio,data:L(t.id)}),t.pauseTime&&n.stepActs.push({type:A.InterAction,data:{pauseTime:t.pauseTime}})),s.push(n)}if(s.length>0){let e={ext:{name:"起点"},stepActs:[{type:A.OpenLight,data:{mode:1,color:i.customSetting.otherSetting.lightStrip.lightStripSwitch?i.customSetting.otherSetting.lightStrip.taskState.lightColor:-1,feature:i.customSetting.otherSetting.lightStrip.taskState.lightType}},{type:A.SetSpeed,data:{speed:i.customSetting.cruise.speed/100}}]},t={name:"自定义任务"+(new Date).getTime(),runNum:a,runMode:+(i.customSetting.basic.runMode||1),taskType:E(),runType:[4].includes(i.robotType)?23:30,curPt:e,pts:s,backPt:{},ignorePublicSite:!0};console.log(t,1111111111),U.getInstance().startTask(t)}else _.show(j.global.t("index.wzdsj"))}else _.fail(j.global.t("setting.qxzrwlx"))}return T((()=>{p.value=!1,f()})),(e,a)=>(k(),o("div",re,[n("div",pe,[n("div",me,c(e.$t("index.zdy")),1),n("div",{class:"create-task btn",onClick:D},[n("img",{src:r(B)},null,8,ve),n("div",null,c(e.$t("index.cjrw")),1)])]),n("div",ge,[n("p",he,[n("span",ke,c(e.$t("index.mc")),1),n("span",ye,c(e.$t("index.dw")),1),n("span",be,c(e.$t("index.active")),1),n("span",fe,c(e.$t("index.Operation")),1)]),n("div",xe,[(k(!0),o(l,null,d(h.list,((a,t)=>(k(),o("p",{class:u(["task-item",{active:t===h.curSelect}]),key:a.id,onClick:e=>function(e,a){h.curSelect=a}(0,t)},[n("span",Ie,c(a.name),1),n("span",we,c(a.taskData.length),1),n("span",De,c(r(y)(a.taskData)),1),n("span",je,[n("span",{class:"operate",onClick:I((e=>async function(e,a){V.show({downTimes:10}).then((async a=>{a&&(h.curTask=e,p.value=!0,h.curTask.taskData=await x(e.taskData))}))}(a)),["stop"])},c(e.$t("setting.bj")),9,Se),n("span",{class:"operate",onClick:I((e=>function(e,a){V.show({downTimes:10}).then((async a=>{a&&(h.curTask=e,m.value=!0)}))}(a)),["stop"])},c(e.$t("setting.sc1")),9,Ce)])],10,Te)))),128))])]),n("div",$e,[g(H,{typeValue:"customize"}),n("div",{class:"curise_enter2 font1",onClick:M},c(e.$t("index.ljcf")),1)]),m.value?(k(),o("div",_e,[n("div",ze,[n("div",Le,c(e.$t("starup.ts")),1),n("div",Ve,[n("span",qe,c(e.$t("index.qdscgrw")),1)]),n("div",Ae,[n("div",{onClick:a[0]||(a[0]=e=>m.value=!1)},c(e.$t("index.qx")),1),n("div",{onClick:z},c(e.$t("index.qd")),1)])])])):v("",!0),p.value?(k(),b(ue,{key:1,data:h.curTask,onCancel:S,onSure:C},null,8,["data"])):v("",!0)]))}}),[["__scopeId","data-v-93d52e24"]]);export{Pe as default};
