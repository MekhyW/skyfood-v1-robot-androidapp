import{C as e,r as t,W as o,p as a,aZ as l,c as s,a as n,M as i,u as r,S as c,K as d,o as u}from"./@vue-73fba911.js";import{u as g}from"./vue-i18n-5829ac11.js";import{y as f,ai as _,r as w,d as m,$ as p,ay as v,L as b,as as x,Q as y,R as S,X as I,az as T,_ as h}from"./index-d6250428.js";const k={key:0,class:"one-touch-service"},z=["onClick"],j=h(e({__name:"quickFollow",emits:["quickFollow"],setup(e,{emit:h}){g();const j=f();_();let q=t(!1);function F(){q.value?(q.value=!q.value,R()):M().then((e=>{e&&(q.value=!q.value,function(){let e=w();C.follow_target_mode=2==e.follow_target_mode?3:e.follow_target_mode,S.getInstance().sendLaserData({topic:"/laser_state",cmd:"follow.wakeup",followType:C.follow_target_mode}),I.getInstance().startTime("wakeupFollow",500,10,(e=>{e&&1===C.band&&1===C.device?(I.getInstance().removeTime("wakeupFollow"),function(){S.getInstance().sendLaserData({enable_topic:"/laser_state"});const e={max_forward_velocity:j.customSetting.followSetting.max_forward_velocity,max_angular_velocity:j.customSetting.followSetting.max_angular_velocity,max_forward_acc:j.customSetting.followSetting.max_forward_acc,max_angular_acc:j.customSetting.followSetting.max_angular_acc};3==C.follow_target_mode&&(e.runMode=C.runType?2:1);S.getInstance().sendLaserData({topic:"/laser_state",cmd:"follow.start",followType:C.follow_target_mode,extra:e})}()):0===e&&D()}))}())}))}const C=o({isShow:!1,follow_target_mode:0,runType:!1,device:0,deviceId:"",band:0,errCode:0});C.isShow=a((()=>{let e=w();const t=f().customSetting,o=[7,8].includes(j.robotType)?t.basic.jackModel:t.basic.model;return t.followSetting.quick_start_switch&&e.follow_target_mode&&o.includes(6)&&3!==j.robotType&&!["/starup","/index/Follow","/jacking/Follow"].includes(m.currentRoute.value.fullPath)}));const L=T((function(e,t){b.logErrNew("RealState",e,t)}),1e3);function D(){!x.isShowStatus()&&q.value&&(q.value=!1,R(),x.show({data:{errText:y.global.t("starup.ts"),errInfo:y.global.t("setting.gssbqbzjzyshljzt"),errType:129},cancelText:y.global.t("index.qx"),sureText:y.global.t("starup.cs"),sure:()=>{F(),x.close()},cancel:()=>{R(),x.close()}}))}l((()=>{let e=w();C.follow_target_mode=2==e.follow_target_mode?3:e.follow_target_mode;const t=p.offlineSetting.followSetting||{};C.runType=2==t.runMode,v.on("follow",(e=>{if(["unreachable","initialize_failed"].includes(e.follow_state))D(),L("initialize_failed",{errCode:100015,errText:"initialize_failed",...p.getUploadLog()});else if(["tracking","initialized"].includes(e.follow_state)){const e=[7,8].includes(j.robotType)?"/jacking/Follow":"/index/Follow";q.value&&(m.push({path:e}),h("quickFollow",6),q.value=!1)}else"stop"===e.follow_state&&(q.value=!1,b.loginfoNew("RealState","stop",{data:e}));e.messageInfo&&(C.device=e.messageInfo.device,C.deviceId="-1"!==e.messageInfo.deviceId?e.messageInfo.deviceId:"",C.band=e.messageInfo.band,C.errCode=e.messageInfo.errCode)}))}));const M=()=>new Promise(((e,t)=>{j.robotstate.battery<=j.customSetting.otherSetting.forceBattery?x.show({data:{errText:y.global.t("starup.ts"),errInfo:y.global.t("starup.dqdlgdqcdhzsygsgn"),errType:129},sureText:y.global.t("index.qd")}):e(!0)}));function R(){S.getInstance().sendLaserData({topic:"/laser_state",cmd:"follow.stop"}),S.getInstance().sendLaserData({topic:"/laser_state",cmd:"follow.sleep",followType:C.follow_target_mode})}return(e,t)=>C.isShow?(u(),s("div",k,[n("div",{class:i(["manu-bar",r(q)?"starting":""]),onClick:c(F,["stop"])},[n("span",{class:i(["iconfont",r(q)?"icon-jiazai":"icon-rentigensui"])},null,2)],10,z)])):d("",!0)}}),[["__scopeId","data-v-b3c3eb1d"]]);export{j as Q};
