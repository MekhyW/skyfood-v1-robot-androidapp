import{C as e,r as t,W as i,aZ as s,a1 as a,c as l,a as o,T as n,K as c,u as r,L as u,a3 as d,R as p,M as v,I as m,ag as f,aM as g,b3 as h,b2 as x,o as y,U as b,S as w,J as k}from"./@vue-73fba911.js";import{_,a as S,b as L}from"./shanchu-72bce93e.js";import{y as j,R as C,aL as I,V as N,g as $,t as z,a as T,$ as q,aA as R,aE as O,aC as F,T as P,aG as J,aB as A,aH as M,aM as U,aN as V,aO as D,P as E,_ as B}from"./index-d6250428.js";import{_ as G}from"./youjiantoucu-eb6c4ade.js";import{C as H,_ as K}from"./cruiseSetting-8659e41a.js";import{_ as W}from"./rightarrow-985a9eff.js";import{_ as Z}from"./delete2-b0832fad.js";import{u as Q}from"./vue-i18n-5829ac11.js";import"./vue-router-fe18c2fe.js";import"./pinia-118dd6fd.js";import"./element-plus-5a8aeb67.js";import"./dayjs-4c03de08.js";import"./@autoxing-9bbbdd2d.js";import"./axios-2c1be958.js";import"./websocket-963e06e0.js";import"./es5-ext-689fde2c.js";import"./lodash-es-fa68f30b.js";import"./@vueuse-171ed302.js";import"./@element-plus-c72353dc.js";import"./@ctrl-ee9bdfd4.js";import"./async-validator-efc2d198.js";import"./@popperjs-892fd7f5.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-da779ce4.js";import"./vue3-loading-overlay-a6191c09.js";import"./vue-slider-component-7621b196.js";import"./vue-6ec50eb9.js";import"./mitt-dab1f1cb.js";import"./swiper-276df855.js";import"./ssr-window-792d0f84.js";import"./dom7-250848e3.js";import"./amfe-flexible-1f7bb7f4.js";import"./@intlify-352b7567.js";const X=e=>(h("data-v-36f0818d"),e=e(),x(),e),Y={class:"curise_cont"},ee={class:"cursie_top"},te={class:"mapfont"},ie=X((()=>o("div",{class:"emptyline"},null,-1))),se={key:0},ae=["src"],le={class:"map_content"},oe={class:"cruise-box"},ne=X((()=>o("view",{class:"portrait horizontal",style:{position:"absolute",margin:"74px 0 0 41px",width:"1046px",height:"225px",border:"3px dashed #FFFFFF","border-radius":"31px"}},null,-1))),ce={class:"poi-name-b"},re=X((()=>o("view",{class:"poi-circle"},null,-1))),ue={class:"poi-name-t mt16"},de=X((()=>o("view",{class:"poi-circle"},null,-1))),pe={class:"poi-name-r"},ve=X((()=>o("view",{class:"poi-circle"},null,-1))),me={class:"poi-name-l"},fe=g('<img style="position:absolute;width:41px;height:50px;margin:48px 0 0 316px;" src="'+_+'" data-v-36f0818d><img style="position:absolute;width:34px;height:34px;margin:58px 0 0 494px;" src="'+S+'" data-v-36f0818d><img style="position:absolute;width:34px;height:34px;margin:88px 0 0 1075px;transform:rotate(90deg);" src="'+S+'" data-v-36f0818d><img style="position:absolute;width:34px;height:34px;margin:288px 0 0 744px;transform:rotate(180deg);" src="'+S+'" data-v-36f0818d><img style="position:absolute;width:34px;height:34px;margin:246px 0 0 25px;transform:rotate(270deg);" src="'+S+'" data-v-36f0818d>',5),ge={class:"curise_bottom"},he={key:0,class:"cruise_tank"},xe={class:"curise_mapchoice"},ye={class:"mapchoice_top font6"},be=["onClick"],we={class:"font6"},ke={style:{"max-width":"400px","overflow-x":"auto","white-space":"nowrap"}},_e={class:"right-box"},Se=["onClick"],Le={class:"curimg"},je=["src"],Ce={key:1,src:D,alt:""},Ie={class:"bottbutton font7"},Ne={key:1,class:"cruise_tank1"},$e={class:"curise_mapchoice1"},ze={class:"mapchoice_top1 font6"},Te={class:"cruise_edit"},qe=[X((()=>o("img",{class:"rotate180",src:G},null,-1)))],Re={style:{height:"50px","line-height":"35px"}},Oe=[X((()=>o("span",{class:"calculation-box"},[o("i",{class:"icon-minus-add min"}),o("i",{class:"icon-add min"})],-1)))],Fe=[X((()=>o("img",{src:L},null,-1)))],Pe={class:"font6",style:{"max-width":"400px","overflow-x":"auto","white-space":"nowrap"}},Je={class:"curimg"},Ae=["onClick"],Me=["onClick"],Ue={key:2,class:"cruise_tank"},Ve={class:"curise_mapchoice2"},De={class:"mapchoice_top2 font6"},Ee={class:"mp_content3"},Be=["onClick"],Ge={class:"font6 delete_content"},He={style:{"max-width":"400px","overflow-x":"auto","white-space":"nowrap"}},Ke=X((()=>o("img",{class:"delete_img",src:W,alt:""},null,-1))),We={key:0,class:"curise_jiashow"},Ze={class:"mapchoice_top2 font6"},Qe={class:"mp_content2"},Xe={class:"font6 delete_content"},Ye={style:{"max-width":"400px","overflow-x":"auto","white-space":"nowrap"}},et=["onClick"],tt={class:"bottbutton font7"},it={key:3,class:"update_password"},st={class:"_makcontent2"},at={class:"update_password_header font6"},lt={class:"password_cont"},ot={style:{"font-size":"20px"}},nt={class:"tip_meth"},ct={key:4,class:"update_password"},rt={class:"_makcontent2"},ut={class:"update_password_header font6"},dt={class:"password_cont"},pt={style:{"font-size":"20px"}},vt={class:"tip_meth"},mt={key:5,class:"update_password"},ft={class:"_makcontent2"},gt={class:"update_password_header font6"},ht={class:"password_cont"},xt={style:{"font-size":"20px"}},yt={class:"tip_meth"},bt=e({beforeRouteEnter(e,t,i){i((e=>{e.getCruisList()}))}}),wt=B(e({...bt,__name:"Cruise",setup(e,{expose:g}){const{t:h}=Q(),x=j(),_=t(!1),S=t(!1),L=t(!1),D=t(!1),B=t(!1),W=t(!1),X=t("");t("");const bt=t(""),wt=t(""),kt=t(!1),_t=t(""),St=t(""),Lt=t([]),jt=t(0),Ct=t(0);let It=i([]);const Nt=t([]),$t=i({curiseList:[],curiseList_cope:[]});s((()=>{C.getInstance().syncCruiseCloud().then((e=>{e?(z.show(h("cruise.tbydsjcg")),Tt()):z.fail(h("cruise.tbydsjsb"))}))})),a((()=>{E.getInstance().onDeactivated()}));for(let t=1;t<=12;t++){let e,i,s;t<=4?1==t||3==t?(e=285+175*(t-1),i=t%2,s=47):(e=285+175*(t-1),i=t%2,s=32):5==t||6==t?(e=888.5,i=2,s=212-80*(6-t)):11==t||12==t?(e=30,i=3,s=212-80*(12-t)):10!=t?(e=285+175*(10-t),i=(t+1)%2,s=260):(e=159,i=(t+1)%2,s=260),It.push({tag:i,left:e,top:s})}function zt(){if(!$t.curiseList||0==$t.curiseList.length)return;const e=$t.curiseList.filter(((e,t)=>(e.id===jt.value&&(Ct.value=t),e.id===jt.value)));console.log(e),e.length||(jt.value=0,Ct.value=0);let t=$t.curiseList[Ct.value].sites,i=t.length,s=12/i;for(let a=0;a<12;a++)It[a].table=null;for(let a=0;a<i;a++){let e=(a*s).toFixed(0);It[e].table=t[a]}}function Tt(){C.getInstance().CuriseListquery().then((e=>{$t.curiseList=e.data,e.data.length||It.forEach((e=>{e.table=null}));for(let t in $t.curiseList)$t.curiseList[t].sel=!1,t==jt.value&&($t.curiseList[t].sel=!0);zt()}))}function qt(){const e=[];$t.curiseList=$t.curiseList_cope;for(let i in $t.curiseList_cope){const t=$t.curiseList_cope[i];e.push({id:t.id,sortNo:+i+1}),t.sel&&(jt.value=t.id,Ct.value=i,zt())}var t;t=e,console.log("putCruiseRouteSort=>"+JSON.stringify({data:t})),C.getInstance().cruiseRouteSort({data:t}).then((e=>{console.log("putCruiseRouteSort=>"+JSON.stringify(e))})),Rt()}function Rt(){if($t.curiseList&&0!=$t.curiseList.length){for(let e of $t.curiseList)e.sel=!1;$t.curiseList[Ct.value].sel=!0,$t.curiseList_cope=JSON.parse(JSON.stringify($t.curiseList)),_.value=!_.value}}function Ot(e){let t=null,i=J[1];i&&i[e+""]&&(t=i[e+""]);let s={mode:A,audioId:q.audioIdset("3111002"),num:1,volume:x.customSetting.sound.switchon?x.customSetting.sound.voiceVolume:0,interval:-1,duration:-1,forcePlay:!0};return t&&(s.url=M(t.fileUrl),t.fileUrl&&(s.audioId=""),s.interval=t.ruleInterval,1==t.ruleType?s.num=t.ruleCount:2==t.ruleType&&(s.duration=t.ruleDuration)),s}function Ft(){I.show({downTimes:10}).then((e=>{if(e){Lt.value=[];let e=N.value||[];if(0==e.length)return void(S.value=!S.value);bt.value=N.value[0].businessId||$.businessId;for(let t=0;t<e.length;t++){let i=e[t];Lt.value.push({floor:i.floorName||i.floor,poiName:i.name,poiId:i.id})}S.value=!S.value}}))}function Pt(){Nt.value=[],S.value=!1,L.value=!0}function Jt(){console.log(Nt),""!=wt.value?W.value=!0:kt.value=!0}function At(){let e={id:wt.value,name:St.value,businessId:bt.value,sites:Nt.value};C.getInstance().CuriseListadd(e).then((e=>{e?(z.show(h("cruise.gxcg")),S.value=!0,D.value=!1,W.value=!1,L.value=!1,wt.value="",Tt()):z.fail(h("cruise.gxsb"))}))}function Mt(){wt.value="",B.value=!1,S.value=!S.value,L.value=!L.value}function Ut(){B.value=!B.value}async function Vt(){try{T.show(),await C.getInstance().syncCruiseLocal()?z.show(h("cruise.scydsjcg")):z.fail(h("cruise.scydsjsb"))}catch(e){z.fail(h("cruise.scydsjsb"))}finally{S.value=!1,B.value=!1,T.close()}}function Dt(){let e=[X.value];C.getInstance().CuriseListdelete(e).then((t=>{t?(console.log(e,t),z.show(h("cruise.sccg")),D.value=!1,Tt()):z.fail(h("cruise.scsb"))}))}function Et(){if(""==_t.value)return void z.fail(h("cruise.xylxbnwk"));if(Nt.value.length<2)return void z.fail(h("cruise.dwgs"));if(1==[...new Set(Nt.value)].length)return void z.fail(h("cruise.dwcf"));let e=$t.curiseList||[];if(0==e.length);else for(let i=0;i<e.length;i++)if(_t.value==e[i].name)return void z.fail(h("cruise.yytmxylx"));let t={name:_t.value,businessId:bt.value,sites:Nt.value};C.getInstance().CuriseListadd(t).then((e=>{e?(z.show(h("cruise.xzcg")),S.value=!0,D.value=!1,kt.value=!1,L.value=!1,_t.value="",wt.value="",Tt()):z.fail(h("cruise.xzsb"))}))}function Bt(){W.value=!1}const Gt=e=>{console.log(e);const t=(N.value||[]).filter(((t,i)=>t.id===e.poiId));return console.log(t),t.length?{poiId:t[0].id,poiName:t[0].name,floor:t[0].floorName||t[0].floor,floorName:t[0].floorName}:{poiId:e.poiId,poiName:e.poiName,floor:e.floorName||e.floor,floorName:e.floorName,invalid:!0}};function Ht(){kt.value=!1,wt.value=""}function Kt(){const e=q.offlineSetting.cruiseSetting||{};let t=0;if(0==e.baseLine.type?t=99999:1==e.baseLine.type&&(t=e.baseLine.num),x.customSetting.cruise||x.$patch((e=>{e.customSetting.cruise={},e.customSetting.cruise.standbyTime=30,e.customSetting.cruise.speed=30})),!$t.curiseList||0==$t.curiseList.length)return void z.show(h("index.qtjxylx"));let i=JSON.parse(JSON.stringify($t.curiseList[Ct.value].sites||[]));new Promise((e=>{if(i[0].areaId)e(i);else{let t=0,s=[],a=()=>{if(t++,t==i.length){for(let e=0;e<i.length;e++)i[e]&&s.push(i[e]);s.length>0?e(s):z.show(h("index.zdysx"))}};for(let e=0;e<i.length;e++){let t=C.getInstance();i[e].poiId&&t.getPoiById(i[e].poiId).then((t=>{i[e]=t,a()})).catch((e=>{a()}))}}})).then((e=>{let i=[];if(0==x.customSetting.cruise.standbyTime)for(let t=0;t<e.length;t++){let s=e[t];i.push({x:s.coordinate[0],y:s.coordinate[1],yaw:s.yaw,areaId:s.areaId,dockingRadius:s.properties&&s.properties.dockingRadius?s.properties.dockingRadius:"1",ext:{name:s.name,id:s.id},stepActs:[{type:R.PlayAudio,data:Ot(s.id)}]})}else for(let t=0;t<e.length;t++){let s=e[t];i.push({x:s.coordinate[0],y:s.coordinate[1],yaw:s.yaw,areaId:s.areaId,dockingRadius:s.properties&&s.properties.dockingRadius?s.properties.dockingRadius:"1",ext:{name:s.name,id:s.id},stepActs:[{type:R.OpenLight,data:{mode:1,color:x.customSetting.otherSetting.lightStrip.lightStripSwitch?x.customSetting.otherSetting.lightStrip.arriveState.lightColor:-1,feature:x.customSetting.otherSetting.lightStrip.arriveState.lightType}},{type:R.PlayAudio,data:Ot(s.id)},{type:O(23)},{type:R.OpenLight,data:{mode:1,color:x.customSetting.otherSetting.lightStrip.lightStripSwitch?x.customSetting.otherSetting.lightStrip.taskState.lightColor:-1,feature:x.customSetting.otherSetting.lightStrip.taskState.lightType}}]})}if(i.length>0){let e={ext:{name:"起点"},stepActs:[{type:R.OpenLight,data:{mode:1,color:x.customSetting.otherSetting.lightStrip.lightStripSwitch?x.customSetting.otherSetting.lightStrip.taskState.lightColor:-1,feature:x.customSetting.otherSetting.lightStrip.taskState.lightType}},{type:R.SetSpeed,data:{speed:x.customSetting.cruise.speed/100}}]},s={name:"巡游任务"+(new Date).getTime(),runNum:t,runMode:+(x.customSetting.basic.runMode||1),taskType:F(),runType:23,curPt:e,pts:i,backPt:{},ignorePublicSite:!0};P.getInstance().startTask(s)}else z.show(h("index.wzdsj"))}))}return g({getCruisList:Tt}),(e,t)=>(y(),l("div",Y,[o("div",ee,[o("div",null,[o("div",te,n(e.$t("index.xydt")),1),ie]),o("div",{class:"curise_maplist",onClick:Rt},[$t.curiseList&&$t.curiseList.length>0?(y(),l("div",se,n($t.curiseList[Ct.value].name),1)):c("",!0),o("div",null,n(e.$t("index.qh")),1)]),o("div",{class:"cruiseSet",onClick:Ft},[o("img",{src:r(U)},null,8,ae)])]),o("div",le,[o("view",oe,[ne,(y(!0),l(u,null,d(r(It),((e,t)=>(y(),l("div",null,[e.tag<2&&e.table?(y(),l("view",{key:0,class:"portrait cruise-poi-box horizontal",style:b("position: absolute;width: 175px;margin: "+e.top+"px 0 0 "+e.left+"px;")},[o("view",ce,n(0==e.tag?e.table.poiName||e.table.name:" "),1),re,o("view",ue,n(1==e.tag?e.table.poiName||e.table.name:" "),1)],4)):2==e.tag&&e.table?(y(),l("view",{key:1,class:"landscape cruise-poi-box reverser horizontal",style:b("position: absolute;margin: "+e.top+"px 0 0 "+e.left+"px;")},[de,o("view",pe,n(e.table.poiName||e.table.name),1)],4)):3==e.tag&&e.table?(y(),l("view",{key:2,class:"landscape cruise-poi-box horizontal",style:b("position: absolute;margin: "+e.top+"px 0 0 "+e.left+"px;")},[ve,o("view",me,n(e.table.poiName||e.table.name),1)],4)):c("",!0)])))),256)),fe])]),o("div",ge,[p(H,{typeValue:"baseLine"}),o("div",{class:"curise_enter2 font1",onClick:Kt},n(e.$t("index.ljcf")),1)]),_.value?(y(),l("div",he,[o("div",xe,[o("div",ye,n(e.$t("index.xylxxz")),1),o("div",{class:v($t.curiseList.length>4?"mp_content2":"mp_content")},[(y(!0),l(u,null,d($t.curiseList_cope,((e,t)=>(y(),l("div",{key:e.id,onClick:e=>function(e,t){for(let i of $t.curiseList_cope)i.sel=!1;$t.curiseList_cope[t].sel=!0}(0,t)},[o("div",we,[o("span",ke,n(e.name),1)]),o("div",_e,[o("span",{class:"iconfont icon-zhiding",onClick:w((i=>function(e,t){$t.curiseList_cope.splice(t,1),$t.curiseList_cope.unshift(e)}(e,t)),["stop"])},null,8,Se),o("div",Le,[e.sel?(y(),l("img",{key:0,src:r(V),alt:""},null,8,je)):(y(),l("img",Ce))])])],8,be)))),128))],2),o("div",Ie,[o("div",{onClick:Rt},n(e.$t("index.qx")),1),o("div",{onClick:qt},n(e.$t("index.qd")),1)])])])):c("",!0),S.value?(y(),l("div",Ne,[o("div",$e,[o("div",ze,[o("div",Te,[o("div",{onClick:Vt},qe),o("span",Re,n(e.$t("cruise.xylxsz")),1),o("div",{class:"oprate-box"},[o("div",{class:"cruise_editjia",onClick:Pt},Oe),o("div",{onClick:Ut},Fe)])])]),o("div",{class:v($t.curiseList&&$t.curiseList.length>4?"mp_content2":"mp_content")},[(y(!0),l(u,null,d($t.curiseList,((e,t)=>(y(),l("div",{key:e.id},[o("div",Pe,[o("span",null,n(e.name),1)]),o("div",Je,[m(o("img",{onClick:t=>function(e){console.log(e),D.value=!0,X.value=e.id}(e),src:K,alt:""},null,8,Ae),[[k,B.value]]),m(o("img",{onClick:t=>function(e,t){S.value=!1,St.value=e.name,wt.value=e.id;let i=[],s=e.sites;for(let a=0;a<s.length;a++){const e=s[a],t=Gt(e);i.push(t)}i.sort(((e,t)=>e.floor-t.floor)),Nt.value=i,console.log("editcuriseList",Nt),L.value=!0}(e),src:G,alt:""},null,8,Me),[[k,!B.value]])])])))),128))],2)])])):c("",!0),L.value?(y(),l("div",Ue,[o("div",Ve,[o("div",De,n(e.$t("cruise.xydwxz")),1),o("div",Ee,[(y(!0),l(u,null,d(Lt.value,((e,t)=>(y(),l("div",{key:e.poiName,onClick:t=>function(e,t){Nt.value.push(e)}(e)},[o("div",Ge,[o("span",He,n(e.floor?e.floor+"F-"+e.poiName:e.poiName),1),Ke])],8,Be)))),128))])]),L.value?(y(),l("div",We,[o("div",Ze,n(e.$t("cruise.bjxylx")),1),o("div",Qe,[(y(!0),l(u,null,d(Nt.value,((t,i)=>(y(),l("div",{key:t.id},[o("div",Xe,[o("span",Ye,n(t.invalid?e.$t("cruise.wxdw")+"-"+t.poiName:t.floor?t.floor+"F-"+t.poiName:t.poiName),1),o("img",{onClick:e=>function(e){Nt.value.splice(e,1)}(i),class:"delete_img",src:Z},null,8,et)])])))),128))]),o("div",tt,[o("div",{onClick:Mt},n(e.$t("index.qx")),1),o("div",{onClick:Jt},n(e.$t("index.qd")),1)])])):c("",!0)])):c("",!0),D.value?(y(),l("div",it,[o("div",st,[o("div",at,n(e.$t("starup.ts")),1),o("div",lt,[o("span",ot,n(e.$t("cruise.qrscxulx")),1)]),o("div",nt,[o("div",{onClick:t[0]||(t[0]=e=>D.value=!1)},n(e.$t("index.qx")),1),o("div",{onClick:Dt},n(e.$t("index.qd")),1)])])])):c("",!0),kt.value?(y(),l("div",ct,[o("div",rt,[o("div",ut,n(e.$t("starup.ts")),1),o("div",dt,[o("span",pt,n(e.$t("cruise.xzxy")),1),m(o("input",{style:{display:"block",height:"30px",width:"60%",margin:"20px auto 0px auto","font-size":"20px"},"onUpdate:modelValue":t[1]||(t[1]=e=>_t.value=e)},null,512),[[f,_t.value]])]),o("div",vt,[o("div",{onClick:Ht},n(e.$t("index.qx")),1),o("div",{onClick:Et},n(e.$t("cruise.bc")),1)])])])):c("",!0),W.value?(y(),l("div",mt,[o("div",ft,[o("div",gt,n(e.$t("starup.ts")),1),o("div",ht,[o("span",xt,n(e.$t("cruise.qrtj")+St.value+e.$t("cruise.xg")),1)]),o("div",yt,[o("div",{onClick:Bt},n(e.$t("index.qx")),1),o("div",{onClick:At},n(e.$t("cruise.bc")),1)])])])):c("",!0)]))}}),[["__scopeId","data-v-36f0818d"]]);export{wt as default};
